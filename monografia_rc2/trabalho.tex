\chapter{Desenvolvimento do Trabalho}

O trabalho desenvolvido consistiu em

ferramenta
experimentos
- validação
- modelos de rede
- datasets
- dados reais

\section{Atividades Realizadas}

\subsection{Biblioteca CGraph}

 A biblioteca CGraph \cite{cesar2013cgraph} utilizada foi implementada por um dos autores (Cesar) 
durante seu trabalho de Iniciação Científica e Mestrado, utilizando a linguagem de programação C89 ANSI 
em ambiente POSIX. A biblioteca foi extendida por ambos os autores para análise de processos de disseminação.

A estrutura de dados para representação de grafos é por meio de lista de adjacências, armazenando 
toda a informação necessária em memória física. Para um sistema com 4 GB de memória RAM e arquitetura de 
64 bits, um grafo direcionado está limitado a menos de 500 milhões de arestas, e um grafo não-direcionado 
está limitado a menos de 250 milhões de arestas.

A biblioteca está em desenvolvimento, e já possui diversos algoritmos para entrada, geração, métrica e 
simulação de grafos não-direcionados, apresentados a seguir:

\begin{itemize}
 \setlength{\itemsep}{0.0\baselineskip}
 \item Leitura de \textit{datasets}.
 \item Inserção de arestas, extração de subgrafo.
 \item Extração de componentes.
 \item Métricas de centralidade: grau, intermediação, proximidade, autovetor, PageRank e $k$-core.
 \item Cálculo de distância geodésica.
 \item Assortatividade.
 \item Modelos de rede: grafo completo, Erdös-Rényi, Barabási-Albert, Watts-Strogatz, Ravasz-Barabási.
 \item Layout com saída SVG: aleatório, circular, circular ordenado por grau, definido pelo usuário.
 \item Modelos de disseminação: SI, SIS, SIR, SEIR, Daley-Kendall, Zumbi.
\end{itemize}

Os modelos de disseminação comportam apenas o caso de \emph{disseminação síncrona}, onde a cada
passo de tempo todos os individuos computam seu próximo estado, levando em conta seu estado atual e
uma possível interação com um indivíduo infeccioso. Ainda não são suportados (1) mais que
um estado infeccioso, (2) infecção múltipla a partir de um único infeccioso \cite{borge2012locating} ou 
(3) modelos assíncronos, onde apenas um indivíduo infeccioso transmite por turno.

A simulação é realizada de forma abstraída: a função \texttt{graph\_propagation\_t}
executa os passos, contando o número de indivíduos infecciosos e escolhendo uniformemente entre seus
adjacentes com quem ele interage. O modelo de propagação, representado na estrutura 
\texttt{graph\_propagation\_model\_t}, deve implementar dois \textit{callbacks} para a 
execução da propagação, de forma semelhante à especialização em orientação a objeto:

\begin{itemize}
 \item \texttt{graph\_transition\_t}: Determina a transição dos indivíduos, dependendo do estado atual e 
       das interações escolhidas.
 \item \texttt{graph\_is\_end\_t}: Determina se a propagação já atingiu um estado estacionário.
\end{itemize}

\subsection{Validação da simulação}

Modelos de disseminação podem ser compreendidos como um processo discreto ou 
contínuo. Em um processo discreto, cada indivíduo encontra-se em um dado estado, transitando em instantes
discretos conforme o estado dos seus vizinhos e de acordo com certas probabilidades. No processo contínuo, tais 
probabilidades são vistas como taxas de transição entre compartimentos, e o comportamento do processo é
obtido solucionando-se equações diferenciais. 

Espera-se que o resultado obtido em uma solução do modelo diferencial corresponda àquele observado em um 
grafo completo com um número infinito de vértices; na prática, bastam algumas centenas de vértices para
se obter comportamentos semelhantes. 

O modelo discreto é solucionado sobre um grafo completo com $N=500$ vértices, com critério de parada de que 
nenhum vértice esteja no estado infeccioso. Tal critério não pode ser satisfeito para o modelo SIS sem um 
tempo de processamento muito longo, então a simulação é interrompida arbitrariamente após 90 iterações\footnotemark.

\footnotetext{Este limite corresponde a um limite codificado na biblioteca de propagação, onde o número de
iterações é limitado a $10 \log_2 N$, para evitar simulações onde a condição de parada é muito improvável ou
mesmo impossível.}

Para solucionar o modelo contínuo, empregamos um método de Runge-Kutta de ordem 2 com passo de tempo
$h=10^{-3}$. Definimos a proporção inicial de suscetíveis em $s_0 = 1-1/N$, e a de infectados em $i_0 = 1/N$. 
Definimos o critério de parada como satisfazer a inequação $|i - i_\infty| < 1/N$, onde $i$ é a proporção de 
indivíduos no estado infeccioso e $i_\infty$ é a solução analítica para $t \to \infty$. 

Utilizamos os parâmetros $\alpha=1$, $\beta=1/2$ e $\gamma=1$ para a solução numérica e para a
simulação em grafo, quando apropriado. Executamos 50 repetições da simulação, e calculamos a média e 
desvio padrão do número de passos e da proporção final de suscetíveis. Os resultados estão mostrados na 
Tabela \ref{tab:valida-simulacao}. Os dois modelos são em geral equivalentes, exceto por incompatibilidades
no tempo de propagação do modelo SIS e na proporção de suscetíveis do modelo Daley-Kendall. As causas 
destas discrepâncias não foram examinadas. 

\begin{table}[!htb]
 \centering
 \caption{Comparação entre solução diferencial e simulação em grafo completo}\label{tab:valida-simulacao}
 \begin{tabular}{|l|c|cc|cc|}
  \hline
  \multirow{2}{*}{Modelo} & \multirow{2}{*}{$s_\infty$ (\%)} & \multicolumn{2}{c|}{Diferencial} & \multicolumn{2}{c|}{Simulação} \\ \cline{3-6}
                          &                                    & Tempo & Suscetíveis (\%)         & Tempo        & Suscetíveis (\%) \\ \hline
  SI                      &  0.0000                            & 12.4  & 0.20                     & 17.2$\pm$1.3 & 0.00             \\
  SIS                     &  50.000                            & 22.1  & 50.2                     &              & 49.9$\pm$2.3     \\
  SIR                     &  20.389                            & 32.5  & 20.4                     & 32.3$\pm$3.4 & 20.5$\pm$2.7     \\
  SEIR                    &  20.389                            & 44.2  & 20.4                     & 47.0$\pm$5.6 & 20.2$\pm$2.9     \\
  Daley-Kendall           &  5.8924                            & 22.5  & 5.98                     & 24.6$\pm$2.8 & 8.4$\pm$1.5      \\ \hline
 \end{tabular}
\end{table}

\subsection{Propagação em \textit{datasets}}

O estudo de disseminação em redes reais permite visualizar o impacto das diversas propriedades estruturais no sucesso de uma propagação.
Se por um lado redes reais possuem diversas características difíceis de serem replicadas em modelos, por outro é difícil comparar 
o comportamento entre as mesmas.

As redes utilizadas para uma simulação de propagação são descritas a seguir. Todas foram tratadas como não-direcionadas.

\begin{itemize}
 \item \texttt{macaque}: Rede cortical de um macaco;
 \item \texttt{cat}: Rede cortical e talâmica de um gato;
 \item \texttt{mangdry}, \texttt{mangwet}: Rede alimentar do Estuário Mangrove nas temporadas de seca e chuva;
 \item \texttt{baydry}, \texttt{baywet}: Rede alimentar da baía da Flórida nas temporadas de seca e chuva;
 \item \texttt{email}: Rede de contatos de e-mail de membros da Universitat Rovira i Virgili (Tarragona);
 \item \texttt{powergrid}: Rede de transmissão elétrica no leste dos Estados Unidos;
 \item \texttt{pgp}: Rede de confiança do esquema de criptografia PGP;
 \item \texttt{astrophysics}: Rede de colaboração na área de Astrofísica;
 \item \texttt{internet}: Rede de roteadores da Internet no nível de Sistemas Autônomos;
 \item \texttt{enron}: Rede de contatos de e-mail da companhia Enron;
 \item \texttt{15m}: Rede de contatos dos participantes do movimento espanhol 15 de Mayo no Twitter.
\end{itemize}

 As métricas realizadas sobre cada rede, que esperamos que tenham impacto sobre o sucesso de uma propagação são
\begin{itemize}
 \item Número de vértices $N$. 
 \item Grau médio $\langle k \rangle$. 
 \item Coeficiente de agrupamento médio $\langle C \rangle$. 
 \item Assortatividade $r$.
 \item Máximo \textit{$k$-core} $\kappa$.
\end{itemize}

 Realizamos 50 repetições do modelo de propagação SIR com parâmetros $\alpha = 1$ e $\beta = 1/2$ para cada \textit{dataset}, 
e calculamos a média e desvio padrão do tempo de propagação e da proporção final de suscetíveis. As métricas e resultados 
destas simulações estão registradas na Tabela \ref{tab:dataset-simulation}.

\begin{table}[!htb]
 \centering
 \caption{Execução em datasets}\label{tab:dataset-simulation}
 \begin{tabular}{|l|ccccc|cc|}
  \hline
     \textit{dataset} & $N$   & $\langle k \rangle$ & $\langle C \rangle$ & $r$    & $\kappa$ & Tempo            & Suscetíveis (\%) \\ \hline
     \texttt{macaque} & 94    & 32.2                & 0.774               & -0.391 & 28       & $21.30 \pm 6.5$  & $38.72 \pm 16.6$ \\
         \texttt{cat} & 95    & 24.6                & 0.615               & -0.140 & 19       & $21.46 \pm 7.0$  & $41.77 \pm 18.6$ \\
     \texttt{mangdry} & 97    & 29.8                & 0.461               & -0.532 & 23       & $21.98 \pm 4.2$  & $33.03 \pm 11.5$ \\
     \texttt{mangwet} & 97    & 29.8                & 0.468               & -0.539 & 23       & $21.74 \pm 5.1$  & $35.81 \pm 14.3$ \\
      \texttt{baydry} & 128   & 32.9                & 0.335               & -0.133 & 24       & $23.76 \pm 6.8$  & $37.08 \pm 17.1$ \\
      \texttt{baywet} & 128   & 32.4                & 0.335               & -0.157 & 23       & $23.98 \pm 5.5$  & $32.20 \pm 11.6$ \\
       \texttt{email} & 1133  & 9.62                & 0.221               & +0.112 & 11       & $41.90 \pm 14.5$ & $64.16 \pm 12.3$ \\
   \texttt{powergrid} & 4941  & 2.67                & 0.080               & -0.073 & 5        & $12.54 \pm 8.5$  & $99.71 \pm 0.3$  \\
         \texttt{pgp} & 10680 & 4.55                & 0.266               & +0.178 & 31       & $9.82  \pm 11.6$ & $99.83 \pm 0.8$  \\
    \texttt{internet} & 22963 & 4.22                & 0.230               & -0.041 & 25       & $37.26 \pm 20.1$ & $99.13 \pm 0.6$  \\
\texttt{astrophysics} & 16706 & 16.1                & 0.670               & +0.452 & 56       & $62.22 \pm 26.5$ & $75.99 \pm 10.6$ \\
       \texttt{enron} & 36692 & 10.7                & 0.509               & -0.101 & 43       & $41.00 \pm 33.0$ & $95.32 \pm 4.4$  \\
         \texttt{15m} & 87569 & 109.9               & 0.224               & -0.164 & 185      & $72.26 \pm 5.4$  & $80.19 \pm 0.3$  \\ \hline
 \end{tabular}
\end{table}

Redes assortativas tendem a ser mais resilientes a ataques direcionados, de modo que se alguns 
\textit{hubs} tornarem-se refratários à disseminação (por exemplo, no estado Removido do modelo
SIR), a disseminação persiste se outros \textit{hubs} se mantiverem infecciosos. Do contrário,
redes desassortativas tendem a se tornarem desconectadas quando alguns \textit{hubs} são 
removidos, de modo que a infecção pode falhar em atingir todos os indivíduos.

Alguns \textit{datasets} (\texttt{powergrid}, \texttt{pgp}, \texttt{internet}) apresentam propagação extremamente ineficiente, com praticamente 
todos os indivíduos permanecendo suscetíveis. As causas deste comportamento não estão claras, uma vez que as métricas estudadas não apontam para
uma classificação comum para estas redes. Mais experimentos devem ser realizados, variando a proporção de nós infectados iniciais e suas posições
relativas na rede.

\subsection{Comparação de propagação entre modelos de rede equivalentes}

Nesta etapa do trabalho foram feitos experimentos para evidenciar as características instrínsicas dos modelos de rede. Foi fixado um modelo de propagação, para que os resultados obtidos através da propagação de informação em diferentes modelos pudessem ser comparados. Os resultados calculados são: (1) tempo de propagação de uma informação na rede e (2) o alcance da propagação. O alcance da propagação consiste no número de vértices que receberam a informação.

Para a execução dos experimentos foi escolhido o modelo SI (Suscetível-infectado), dado que é um modelo mais determinístico. Em outros modelos como o SIR e o SIS, a propagação pode extinguir-se de forma inesperada, pois os nós infectados podem retornar ao estado suscetível ou recuperado. Com exceção do modelo Ravasz-Barabási, o número de vértices $N$ foi fixado em 10 mil e o grau médio $\langle k \rangle$ foi fixado em 9. A escolha do grau médio se deu pela condição para que um grafo aleatório não possua componentes desconexos, sendo $k > \log(N)$. A propagação da informação nos modelos é repetida 1000 vezes, para que seja analisado o comportamento médio da propagação para cada modelo de rede. Os resultados da execução dos experimentos são apresentados na Tabela \ref{tab:network-model}.

\begin{table}[h]
 \label{tab:network-model}
 \caption{Métricas das redes para os modelos apresentados}
 \centering
  \begin{tabular}{lcccc}
   \hline
	&	ER	&	WS	&	BA	&	RB	\\ \hline
Tempo de propagação(ms)	&	136,3	&	36,7	&	81,3	&	65,2	\\
Média de infectados	&	9999,0	&	10000,0	&	10000,0	&	6726,2	\\
Desvio Padrão de infectados	&	0,1	&	0,0	&	0,0	&	203,0	\\
Média de suscetivos	&	1,0	&	0,0	&	0,0	&	1049,8	\\
Desvio Padrão de suscetivos	&	0,1	&	0,0	&	0,0	&	203,0	\\
Média de mensagens	&	1053834,9	&	251095,4	&	451380,0	&	465174,9	\\
Desvio Padrão de mensagens	&	19588,1	&	35222,9	&	82172,8	&	28969,0	\\
Média de iterações	&	134,0	&	55,3	&	73,1	&	131,0	\\
Desvio Padrão de iterações	&	0,0	&	4,0	&	8,5	&	0,0	\\
Agrupamento médio	&	0	&	0,133	&	0,008	&	0,825	\\
Caminho mínimo médio	&	5,33	&	5,938	&	3,474	&	3,776	\\
Diâmetro	&	10	&	9	&	5	&	10	\\ \hline

  \end{tabular}
 \end{table}

Através da análise do tempo de propagação, percebe-se o modelo de WS teve uma propagação muito mais rápida que os demais modelos. Isto se deve as propridades de \textit{small world}. Este modelo propagou a informação para toda a rede com o menor número de passos e o menor número de mensagens. O segundo modelo que propagou a informação mais rapidamente foi o BA, o qual possui a propriedade de redes livres de escala. Um fato importante em redes livres de escala é que estas também têm a propriedade \textit{small world} \cite{watts1999small}. A proprieade \textit{small world} é notada em livres de escala dado que o diâmetro de uma rede $d$ cresce em escala logarítmica em relação ao número de nós $N$ \cite{kosmidis2007propagation}.

Ao contrário dos dois primeiros modelos analisados, os modelos ER e RB tiveram o número de passos limitado pelo critério de parada. O critério de parada consiste em $K \log_2(N)$. A lógica é que uma propagação "perfeita" necessita de $\log_2(N)$ passos. Através desta função a progressão de infectados teria ordem quadrática, totalizando $\log_2(N)$ passos. O $k$ consiste em um parâmetro de segurança. Portanto, nota-se que RB possui um tempo de propagação menor que BA, porém, cerca de 14\% da rede não recebeu a informação. Analisando-se o diâmetro da rede, fica claro que as modelos ER e RB, que atingiram o limite de passos, possuem um diâmetro de rede maior.

Em geral, a principal propriedade da rede WS consiste no comportamente médio entre redes aleatórias e regulares. Isto permite que a rede seja altamente agrupada (como em redes regulares) e manter a característica de caminhos mínimos. Estas características, combinadas a um diâmetro menor, mostram que as características de uma rede \textit{small eorld} são muito favoráveis a propagação de informação. Vale notar também que, sem o limite de execução pelo número de passos, o modelo RB tem um comportament próximo de BA. 

Analisando-se RB, Ravasz e Barabási \cite{ravasz2003hierarchical} afirmam que as principais características deste modelo consiste no alto grau de agrupamento e comportamento livre de escala. Wang et al \cite{fu2007information} realizaram diversos experimentos de propagação de informação com o modelo SIR em redes hierárquicas. Os resultados demonstraram que o alcance da propagação depende da localização do indivíduo que inicia a mesma. Wang et al constataram que o alcance é máximo ocorre quando o vértice escolhido inicialmente está em uma camada intermediária. Os resultados das simulações indicaram que a melhor estratégia para propagar uma informação consiste em fazer com que indivíduos em camadas intermediárias recebam a informação e espalhem esta ao seus vizinhos. Portanto, o comportamento verificado nos experimentos realizados neste não é anormal.

\subsection{Gripe de Hong Kong}

A Gripe de Hong Kong foi a terceira pandemia de gripe do século XX. Esta gripe foi uma pandemia de categoria 2, segundo o Índice de Severidade de Pandemia (PSI), que consiste em uma classificação para reportar a severidade de uma pandemia nos Estados Unidos, de forma que a categoria 1 é mais branda, enquanto a categoria 5 indica o pior caso de severidade. Os surto ocorreu  entre 1968 e 1969 e matou aproximadamente 1 milhão de pessoas pelo mundo \cite{paul2008fundamental}.

A causa desta pandemia foi o aparecimento de uma nova variação do vírus Influenza A (H3N2), que deu origem a um novo subtipo. Esta variante antigénica produziu em Hong Kong, em meados de Julho, uma epidemia de grande extensão, que se espalhou pelo mundo. Em setembro a pandemia já havia alcançado Índia, Filipinas, Austrália e Europa. Neste mesmo mês as tropas norte-americanas em missão na Guerra do Vietnam, contraíram o vírus e o levaram para os Estados Unidos.

Nos EUA, os primeiros casos foram detectados na Califórnia, de onde a epidemia se propagou rapidamente, estando em Dezembro em todos os Estados. Em todos os países, com exceção dos EUA, a doença foi benigna, não estando associada a grande número de mortes. Um relatório divulgado pela Congressional Quarterly, em 1986, afirmou que quase 50 milhões de pessoas foram infectadas nos Estados Unidos e aproximadamente 33.800 morreram \footnote{Disponível em:  http://www.flu.gov/pandemic/history/}.

Durante o período de infecção a população podia ser dividida em 3 categoria:

\begin{itemize}
\setlength{\itemsep}{0.0\baselineskip}
\item Pessoas infectadas pela gripe;
\item Pessoas que se recuperaram;
\item Pessoas que não foram infectadas.
\end{itemize}

Sabendo-se da aplicação de disseminação de informação no contexto de propagação de epidemias, modelou-se o problema segundo o modelo epidemiológico SIR (Suscetível - infectado - recuperado). Os valores utilizados nos experimentos foram obtidos através da observação da evolução da doença na cidade de Nova Iorque, que na época contava com uma população de aproximadamente 7,9 milhões de pessoas. Os dados são os seguintes:

\begin{itemize}
\setlength{\itemsep}{0.0\baselineskip}
\item Inicialmente têm-se 7,9 milhões de pessoas, sendo 10 infectados rferente as tropas norte-americanas voltando da guerra. 
  \begin{itemize}
  \item $S + I + R = N = 7.9$ milhões
  \end{itemize}
\item Adimensionalizado-se o sistema, tem-se $s + i + r = 1$
  \begin{itemize}
  \item $S(0) \cong 1$
  \item $I(0) = 10/7.900.000 \cong 1.27*10^{-6}$
  \item $R(0) = 0$
  \end{itemize}
\item Período de infecção ($p_i$): 3 dias
  \begin{itemize}
  \item Taxa de recuperação ($\beta$): $1/p_i = 1/3$
  \end{itemize}
\item Em média, uma nova pessoa é infectada cada dia
  \begin{itemize}
  \item Taxa de infecção ($\alpha$): $1/2$
  \end{itemize}
\end{itemize}

Os experimentos realizados para as simulações da propagação desta pandemia em uma rede, foi feita com uma pequena parte da rede social do Facebook \cite{}. Esta rede foi escolhida devido a sua conformidade com uma rede de contato, dado que os vértices são pessoas e as arestas consistem em um relacionamente de "amizade" entre esats pessoas. Segundo Ravasz e Barabási \cite{ravasz2003hierarchical}, redes reais apresentam a coexistência de características intrínsecas de modelos de rede, como o alto grau de agrupamento e a existência de caminhos geodésicos. A rede do Facebook utilizada é não-direcionada e possui 1912 vértices e 26749 arestas. Dimensionalizando-se o problema para esta simulação, $S(o)$ foi 1, dado que $s$ é muito pequeno e 1 é o valor mínimo necessário para se iniciar uma disseminação de doença infecciosa. A Tabela \ref{tab:facebook}

 \begin{table}[h]
 \label{tab:facebook}
 \caption{Informações sobre a propagação da Gripe de Hing Kong na rede do Facebook}
 \centering
  \begin{tabular}{lcccc}
   \hline
   	&	&Número de iterações	\\ \hline
	&	100	&	1000	&	10000	\\ \hline
Média de infectados	&	9,3	&	9,0	&	9,0	\\
Desvio Padrão de infectados	&	1,2	&	0,0	&	0,0	\\
Média de suscetivos	&	1817,4	&	1842,0	&	1842,0	\\
Desvio Padrão de suscetivos	&	135,1	&	125,6	&	125,6	\\
Média de recuperados	&	85,3	&	61,0	&	61,0	\\
Desvio Padrão de recuperados	&	134,6	&	125,6	&	125,6	\\
Média do total de infecções	&	254,1	&	183,7	&	183,7	\\
Desvio padrão do total de infecções	&	408,2	&	383,7	&	383,7	\\ \hline
  \end{tabular}
 \end{table}

Através da simulação com os parâmetros acerca da infecção, percebe-se que a epidemia nos Estados Unidos, de fato, não foi tão severa como outras pandemias como a gripe Espanhola. Percebe-se que a epidemia se estabiliza com um número baixo de infectados, ou seja, dadas as tentativas de infecção, grande maioria se recupera, ou há infecção em pessoas já contaminadas. A grande aplicação de disseminação de epidemias para a área da saúde consiste no cálculo de vacinação em massa para controle de epidemias


\subsection{Sobrevivência ao Apocalipse Zumbi}

\section{Resultados Obtidos}
